// Minimal lightbox script
(function(){
  function qs(sel,ctx){return (ctx||document).querySelector(sel)}
  function qsa(sel,ctx){return Array.from((ctx||document).querySelectorAll(sel))}
  function createOverlay(){
    var o=document.createElement('div');o.className='glightbox-overlay';o.style.display='none';
    o.innerHTML='<a href="#" class="glightbox-close">&times;</a><div class="glightbox-nav"><a href="#" class="glightbox-prev">&#10094;</a><a href="#" class="glightbox-next">&#10095;</a></div><img src="" alt=""><div class="glightbox-caption"></div>';
    document.body.appendChild(o);return o;
  }
  var overlay=createOverlay();
  var imgEl=overlay.querySelector('img'), cap=overlay.querySelector('.glightbox-caption');
  var links=[];
  function openAt(index){
    var link=links[index]; if(!link) return;
    imgEl.src=link.href; cap.textContent=link.getAttribute('data-title')||'';
    overlay.style.display='flex'; overlay.setAttribute('data-index', index);
  }
  function close(){ overlay.style.display='none'; imgEl.src=''; }
  document.addEventListener('click', function(e){
    var a=e.target.closest('a.glightbox');
    if(a){
      e.preventDefault();
      links = Array.from(document.querySelectorAll('a.glightbox[data-gallery="'+a.dataset.gallery+'"]'));
      var idx = links.indexOf(a);
      openAt(idx);
    }
    if(e.target.matches('.glightbox-close')){ e.preventDefault(); close(); }
    if(e.target.matches('.glightbox-prev')){ e.preventDefault(); var i=+overlay.getAttribute('data-index')-1; if(i<0) i=links.length-1; openAt(i); }
    if(e.target.matches('.glightbox-next')){ e.preventDefault(); var i=+overlay.getAttribute('data-index')+1; if(i>=links.length) i=0; openAt(i); }
    if(e.target==overlay){ close(); }
  });
})();